class g{sprite;scene;speed=200;dashSpeed=600;dashDuration=200;dashCooldown=3e3;dashCooldownTimer=0;isDashing=!1;isInvincible=!1;trail=[];trailTimer=0;maxHealth=3;health=3;grazeRadius=40;grazeCooldown=100;grazeTimer=0;pixelSize=4;constructor(e,t,i){this.scene=e;const s=e.add.graphics(),a=65480,h=65535;s.fillStyle(a,1),s.fillRect(4,4,4,4),s.fillRect(6,0,4,4),s.fillRect(4,2,4,2),s.fillRect(2,8,4,4),s.fillRect(8,8,4,4),s.fillRect(0,10,4,2),s.fillRect(10,10,4,2),s.fillRect(2,4,2,4),s.fillRect(10,4,2,4),s.fillStyle(h,.5),s.fillRect(6,-2,4,2),s.fillRect(4,0,2,2),s.fillRect(10,0,2,2),s.generateTexture("player-pixel",16,16),s.destroy(),this.sprite=e.physics.add.sprite(t,i,"player-pixel"),this.sprite.setDisplaySize(16,16),this.sprite.setTint(65480),this.sprite.setBlendMode(window.Phaser.BlendModes.ADD),this.sprite.setSize(12,12),this.sprite.setCollideWorldBounds(!0),this.sprite.setDrag(.9),this.trail=[]}update(e,t,i,s){this.dashCooldownTimer>0&&(this.dashCooldownTimer-=e),this.grazeTimer>0&&(this.grazeTimer-=e),this.isDashing||this.handleMovement(t,s),window.Phaser.Input.Keyboard.JustDown(i)&&this.dashCooldownTimer<=0&&!this.isDashing&&this.dash(s),this.updateTrail(e),this.updateGlow(e)}handleMovement(e,t){let i=0,s=0;if(e.left?.isDown||this.scene.input.keyboard?.addKey("A").isDown?i=-this.speed:(e.right?.isDown||this.scene.input.keyboard?.addKey("D").isDown)&&(i=this.speed),e.up?.isDown||this.scene.input.keyboard?.addKey("W").isDown?s=-this.speed:(e.down?.isDown||this.scene.input.keyboard?.addKey("S").isDown)&&(s=this.speed),t.isDown){const a=window.Phaser.Math.Angle.Between(this.sprite.x,this.sprite.y,t.x,t.y);i=Math.cos(a)*this.speed,s=Math.sin(a)*this.speed}this.sprite.setVelocity(i,s)}dash(e){this.isDashing=!0,this.isInvincible=!0;const t=window.Phaser.Math.Angle.Between(this.sprite.x,this.sprite.y,e.x,e.y);this.sprite.setVelocity(Math.cos(t)*this.dashSpeed,Math.sin(t)*this.dashSpeed),this.scene.sound.play("dash",{volume:.5}),this.createDashTrail(),this.scene.time.delayedCall(this.dashDuration,()=>{this.isDashing=!1,this.sprite.setVelocity(0,0)}),this.scene.time.delayedCall(this.dashDuration,()=>{this.isInvincible=!1}),this.dashCooldownTimer=this.dashCooldown}createDashTrail(){for(let e=0;e<5;e++)this.scene.time.delayedCall(e*30,()=>{if(this.sprite&&this.sprite.active){const t=this.scene.add.graphics(),i=.6-e*.1;t.fillStyle(65480,i);const s=12-e*2;t.fillRect(this.sprite.x-s/2,this.sprite.y-s/2,s,s),t.setBlendMode(window.Phaser.BlendModes.ADD),this.scene.tweens.add({targets:t,alpha:0,duration:300,onComplete:()=>{t.destroy()}})}})}updateTrail(e){if(this.trailTimer+=e,this.trailTimer>50&&(this.sprite.body?.velocity.x!==0||this.sprite.body?.velocity.y!==0)){this.trailTimer=0;const t=this.scene.add.graphics();t.fillStyle(65480,.3),t.fillRect(this.sprite.x-4,this.sprite.y-4,8,8),t.setBlendMode(window.Phaser.BlendModes.ADD),this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>{t.destroy()}})}}updateGlow(e){const t=Math.sin(this.scene.time.now/200)*.3+.7;if(this.sprite.setAlpha(t),this.dashCooldownTimer>0&&this.dashCooldownTimer<500){const i=Math.sin(this.scene.time.now/50)*.5+.5;this.sprite.setTint(i>.5?65480:16777215)}else this.sprite.setTint(65480)}takeDamage(){return this.isInvincible?!1:(this.health--,this.scene.tweens.add({targets:this.sprite,alpha:.2,duration:100,yoyo:!0,repeat:3}),this.scene.cameras.main.shake(200,.01),this.scene.sound.play("hit",{volume:.6}),!0)}heal(){this.health<this.maxHealth&&this.health++}canGraze(){return this.grazeTimer<=0}doGraze(){this.grazeTimer=this.grazeCooldown}getPosition(){return{x:this.sprite.x,y:this.sprite.y}}destroy(){this.sprite.destroy()}}class y extends window.Phaser.Physics.Arcade.Sprite{scene;speed=150;lifespan=5e3;birthTime;isFake=!1;angle=0;isHoming=!1;homingStrength=0;target=null;delayExplode=!1;explodeDelay=0;explodeTimer=0;hasExploded=!1;rotationSpeed=0;orbitCenter=null;orbitRadius=0;orbitAngle=0;constructor(e,t,i,s="bullet"){super(e,t,i,s),this.scene=e,this.birthTime=e.time.now,e.add.existing(this),e.physics.add.existing(this),this.setSize(6,6),this.setDisplaySize(8,8),this.setBlendMode(window.Phaser.BlendModes.ADD)}update(e,t,i){if(e-this.birthTime>this.lifespan){this.destroy();return}if(this.delayExplode&&!this.hasExploded){if(this.explodeTimer+=t,this.explodeTimer>=this.explodeDelay){this.explode();return}const s=Math.sin(e/50)*.5+.5;this.setAlpha(s)}if(this.isHoming&&i&&!this.delayExplode){const s=window.Phaser.Math.Angle.Between(this.x,this.y,i.x,i.y),a=window.Phaser.Math.Angle.RotateTo(this.angle,s,this.homingStrength*t*.001);this.setVelocity(Math.cos(a)*this.speed,Math.sin(a)*this.speed)}if(this.rotationSpeed!==0&&this.orbitCenter){this.orbitAngle+=this.rotationSpeed*t*.001;const s=this.orbitCenter.x+Math.cos(this.orbitAngle)*this.orbitRadius,a=this.orbitCenter.y+Math.sin(this.orbitAngle)*this.orbitRadius;this.setPosition(s,a)}(this.x<-50||this.x>this.scene.scale.width+50||this.y<-50||this.y>this.scene.scale.height+50)&&this.destroy()}setVelocityByAngle(e,t){this.angle=e;const i=t||this.speed;this.setVelocity(Math.cos(e)*i,Math.sin(e)*i)}setFake(e){this.isFake=e,e&&(this.setTint(16737792),this.setAlpha(.5))}setHoming(e=.05){this.isHoming=!0,this.homingStrength=e,this.setTint(16711935)}setDelayExplode(e){this.delayExplode=!0,this.explodeDelay=e,this.setTint(16776960)}setOrbit(e,t,i,s,a){this.orbitCenter={x:e,y:t},this.orbitRadius=i,this.orbitAngle=s,this.rotationSpeed=a,this.setPosition(e+Math.cos(s)*i,t+Math.sin(s)*i)}explode(){if(this.hasExploded)return;this.hasExploded=!0;const e=this.scene.add.graphics(),t=4;for(let i=0;i<8;i++){const s=i/8*Math.PI*2,a=12,h=this.x+Math.cos(s)*a,l=this.y+Math.sin(s)*a;e.fillStyle(16711782,1),e.fillRect(h-t/2,l-t/2,t,t)}e.fillStyle(16776960,1),e.fillRect(this.x-6,this.y-6,12,12),e.setBlendMode(window.Phaser.BlendModes.ADD),this.scene.tweens.add({targets:e,alpha:0,scale:1.5,duration:300,onComplete:()=>{e.destroy()}}),this.scene.sound.play("explosion",{volume:.4}),this.scene.spawnBullets&&this.scene.spawnBullets(this.x,this.y,8,16711680,200),this.destroy()}preUpdate(e,t){super.preUpdate(e,t)}}class w{scene;pool;constructor(e,t=500){this.scene=e;const i=e.add.graphics();i.fillStyle(16711782,1),i.fillRect(1,1,6,6),i.fillStyle(16711935,.5),i.fillRect(0,2,1,4),i.fillRect(7,2,1,4),i.fillRect(2,0,4,1),i.fillRect(2,7,4,1),i.generateTexture("bullet",8,8),i.destroy(),this.pool=e.physics.add.group({classType:y,maxSize:t,runChildUpdate:!0,createCallback:s=>{s.setActive(!1),s.setVisible(!1)}})}spawn(e,t,i,s,a){const h=this.pool.get(e,t,"bullet");return h&&(h.setPosition(e,t),h.setActive(!0),h.setVisible(!0),h.setVelocityByAngle(i,s),h.birthTime=this.scene.time.now,h.hasExploded=!1,h.explodeTimer=0,h.delayExplode=!1,h.isHoming=!1,h.rotationSpeed=0,h.orbitCenter=null,a?h.setTint(a):h.clearTint()),h}spawnCircle(e,t,i,s,a){const h=[];for(let l=0;l<i;l++){const r=l/i*Math.PI*2;h.push(this.spawn(e,t,r,s,a))}return h}spawnFan(e,t,i,s,a,h,l){const r=[],o=i-s/2,d=s/(a-1);for(let c=0;c<a;c++){const p=o+d*c;r.push(this.spawn(e,t,p,h,l))}return r}spawnSpiral(e,t,i,s,a,h){const l=[],r=Math.PI*2*s;for(let o=0;o<i;o++){const d=o/i,c=d*r,p=d*500;this.scene.time.delayedCall(p,()=>{const f=this.spawn(e,t,c,a,h);f&&l.push(f)})}return l}getPool(){return this.pool}clear(){this.pool.clear(!0,!0)}}const n={PHASE_1:1,PHASE_2:2,PHASE_3:3};class m{scene;sprite;bulletPool;maxHealth=100;health=100;phase=n.PHASE_1;attackTimer=0;attackInterval=2e3;moveTimer=0;targetX=0;targetY=0;moveSpeed=30;spiralAngle=0;warningGraphics=null;warningTimer=0;currentAttackPattern=0;constructor(e,t,i,s){this.scene=e,this.bulletPool=s;const a=e.add.graphics();a.fillStyle(3342353,1),a.fillRect(0,0,64,64),a.fillStyle(16711782,1),a.fillRect(8,8,8,8),a.fillRect(48,8,8,8),a.fillRect(16,12,32,8),a.fillRect(8,24,16,12),a.fillRect(40,24,16,12),a.fillStyle(16776960,1),a.fillRect(12,28,8,4),a.fillRect(44,28,8,4),a.fillStyle(16711782,1),a.fillRect(28,32,8,8),a.fillRect(16,44,32,8),a.fillRect(12,48,8,8),a.fillRect(44,48,8,8),a.fillRect(20,52,24,8),a.fillStyle(16711935,.5),a.fillRect(4,4,4,56),a.fillRect(56,4,4,56),a.fillRect(4,4,56,4),a.fillRect(4,56,56,4),a.generateTexture("boss-pixel",64,64),a.destroy(),this.sprite=e.physics.add.sprite(t,i,"boss-pixel"),this.sprite.setDisplaySize(64,64),this.sprite.setBlendMode(window.Phaser.BlendModes.ADD),this.targetX=t,this.targetY=i,this.warningGraphics=e.add.graphics()}update(e,t){this.updatePhase(),this.updateMovement(e),this.attackTimer+=e,this.attackTimer>=this.getAttackInterval()&&(this.attackTimer=0,this.executeAttack(t)),this.spiralAngle+=e*.001,this.updateWarning(e),this.updateGlow()}updatePhase(){const e=this.health/this.maxHealth;e>.7?this.phase=n.PHASE_1:e>.3?this.phase=n.PHASE_2:this.phase=n.PHASE_3}updateMovement(e){if(this.moveTimer+=e,this.moveTimer>3e3){this.moveTimer=0;const s=this.scene.scale.width/2,a=this.scene.scale.height/3,h=100;this.targetX=s+(Math.random()-.5)*h*2,this.targetY=a+(Math.random()-.5)*h}const t=this.targetX-this.sprite.x,i=this.targetY-this.sprite.y;this.sprite.setVelocity(t*this.moveSpeed*.01,i*this.moveSpeed*.01)}getAttackInterval(){switch(this.phase){case n.PHASE_1:return 2500;case n.PHASE_2:return 1800;case n.PHASE_3:return 1200;default:return 2e3}}executeAttack(e){const t=window.Phaser.Math.Angle.Between(this.sprite.x,this.sprite.y,e.x,e.y);switch(this.phase){case n.PHASE_1:this.phase1Attack(t);break;case n.PHASE_2:this.phase2Attack(t,e);break;case n.PHASE_3:this.phase3Attack(t,e);break}this.scene.sound.play("boss-attack",{volume:.3})}phase1Attack(e){this.currentAttackPattern=(this.currentAttackPattern+1)%2,this.currentAttackPattern===0?this.bulletPool.spawnFan(this.sprite.x,this.sprite.y,e,Math.PI/3,5,150):this.bulletPool.spawnCircle(this.sprite.x,this.sprite.y,12,120,16724838)}phase2Attack(e,t){switch(this.currentAttackPattern=(this.currentAttackPattern+1)%3,this.currentAttackPattern){case 0:for(let s=0;s<3;s++)this.scene.time.delayedCall(s*200,()=>{this.bulletPool.spawnCircle(this.sprite.x,this.sprite.y,8,150+s*20,16737996)});break;case 1:for(let s=0;s<5;s++){const a=e+(Math.random()-.5)*.5,h=this.bulletPool.spawn(this.sprite.x,this.sprite.y,a,100,16776960);h&&h.setDelayExplode(1500+s*200)}break;case 2:const i=this.bulletPool.spawn(this.sprite.x,this.sprite.y,e,120,16711935);i&&i.setHoming(.03),this.scene.time.delayedCall(300,()=>{this.bulletPool.spawnFan(this.sprite.x,this.sprite.y,e+Math.PI,Math.PI/2,4,140)});break}}phase3Attack(e,t){switch(this.currentAttackPattern=(this.currentAttackPattern+1)%4,this.currentAttackPattern){case 0:this.crossBarrage();break;case 1:this.fakeBulletAttack(e);break;case 2:this.warningAreaAttack(t);break;case 3:this.spiralStorm();break}}crossBarrage(){for(let e=0;e<5;e++)this.scene.time.delayedCall(e*100,()=>{const t=this.scene.scale.height*(e+1)/6;this.bulletPool.spawn(0,t,0,200,16711680),this.bulletPool.spawn(this.scene.scale.width,t,Math.PI,200,16711680)});this.scene.time.delayedCall(500,()=>{for(let e=0;e<5;e++){const t=this.scene.scale.width*(e+1)/6;this.bulletPool.spawn(t,0,Math.PI/2,200,16711680),this.bulletPool.spawn(t,this.scene.scale.height,-Math.PI/2,200,16711680)}})}fakeBulletAttack(e){for(let t=0;t<8;t++){const i=t/8*Math.PI*2,s=this.bulletPool.spawn(this.sprite.x,this.sprite.y,i,80,16737792);s&&s.setFake(!0)}this.scene.time.delayedCall(500,()=>{for(let t=0;t<6;t++){const i=e+(t-3)*.2;this.bulletPool.spawn(this.sprite.x,this.sprite.y,i,180,16711782)}})}warningAreaAttack(e){this.warningGraphics&&(this.warningGraphics.clear(),this.warningGraphics.lineStyle(3,16711680,.8),this.warningGraphics.strokeCircle(e.x,e.y,60),this.warningTimer=1e3,this.scene.time.delayedCall(1e3,()=>{this.bulletPool.spawnCircle(e.x,e.y,10,150,16711680),this.warningGraphics&&this.warningGraphics.clear()}))}spiralStorm(){for(let e=0;e<16;e++)this.scene.time.delayedCall(e*50,()=>{const t=this.spiralAngle+e*Math.PI*2/8;this.bulletPool.spawn(this.sprite.x,this.sprite.y,t,180+e*10,16711935)})}updateWarning(e){if(this.warningTimer>0){if(this.warningTimer-=e,this.warningGraphics){const t=Math.sin(this.scene.time.now/50)*.5+.5;this.warningGraphics.setAlpha(t)}}else this.warningGraphics&&this.warningGraphics.clear()}updateGlow(){let e=16711782;switch(this.phase){case n.PHASE_2:e=16737996;break;case n.PHASE_3:e=16711680;break}const t=Math.sin(this.scene.time.now/150)*.3+.7;if(this.sprite.setAlpha(t),this.health<this.maxHealth){const i=this.health/this.maxHealth*.5+.5;this.sprite.setTint(e),this.sprite.setScale(1+(1-i)*.2)}}takeDamage(e){return this.health-=e,this.scene.tweens.add({targets:this.sprite,alpha:.3,duration:50,yoyo:!0,repeat:2}),this.scene.cameras.main.shake(100,.005),this.scene.sound.play("boss-hit",{volume:.5}),this.health<=0}isDead(){return this.health<=0}getPosition(){return{x:this.sprite.x,y:this.sprite.y}}getPhase(){return this.phase}destroy(){this.warningGraphics&&this.warningGraphics.destroy(),this.sprite.destroy()}}class S extends window.Phaser.Scene{player;boss;bulletPool;cursors;spaceKey;mousePointer;isGameOver=!1;isPaused=!1;gameTime=0;score=0;grazeCount=0;slowMotionActive=!1;slowMotionTimer=0;upgrades={dashCooldownReduction:0,dashDistanceIncrease:0,grazeScoreMultiplier:1,lifeSteal:!1};onStatsUpdate;onGameOver;onBossDefeated;sounds={};constructor(){super({key:"GameScene"})}preload(){this.createSynthSounds()}createSynthSounds(){const e=new(window.AudioContext||window.webkitAudioContext);this.soundGenerators={dash:()=>this.generateTone(e,800,.1,"sawtooth",.3),hit:()=>this.generateTone(e,200,.2,"square",.4),graze:()=>this.generateTone(e,1200,.05,"sine",.2),"boss-attack":()=>this.generateTone(e,400,.15,"sawtooth",.25),"boss-hit":()=>this.generateTone(e,150,.3,"square",.5),explosion:()=>this.generateNoise(e,.3,.4),"slow-motion":()=>this.generateTone(e,600,.5,"sine",.2)}}generateTone(e,t,i,s,a){const h=e.createOscillator(),l=e.createGain();h.type=s,h.frequency.setValueAtTime(t,e.currentTime),h.frequency.exponentialRampToValueAtTime(t*.5,e.currentTime+i),l.gain.setValueAtTime(a,e.currentTime),l.gain.exponentialRampToValueAtTime(.01,e.currentTime+i),h.connect(l),l.connect(e.destination),h.start(e.currentTime),h.stop(e.currentTime+i)}generateNoise(e,t,i){const s=e.sampleRate*t,a=e.createBuffer(1,s,e.sampleRate),h=a.getChannelData(0);for(let o=0;o<s;o++)h[o]=Math.random()*2-1;const l=e.createBufferSource();l.buffer=a;const r=e.createGain();r.gain.setValueAtTime(i,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+t),l.connect(r),r.connect(e.destination),l.start(e.currentTime)}create(){this.physics.world.setBounds(0,0,this.scale.width,this.scale.height),this.cursors=this.input.keyboard.createCursorKeys(),this.spaceKey=this.input.keyboard.addKey(window.Phaser.Input.Keyboard.KeyCodes.SPACE),this.mousePointer=this.input.activePointer,this.bulletPool=new w(this,500),this.player=new g(this,this.scale.width/2,this.scale.height*.8),this.boss=new m(this,this.scale.width/2,this.scale.height/4,this.bulletPool),this.setupCollisions(),this.createBackground(),this.resetGame(),this.sound.play=e=>{const t=this.soundGenerators[e];return t&&t(),{}}}setupCollisions(){this.physics.add.overlap(this.player.sprite,this.bulletPool.getPool(),this.handlePlayerBulletCollision,(e,t)=>t.active&&!t.isFake,this),this.physics.add.overlap(this.player.sprite,this.boss.sprite,this.handlePlayerBossCollision,null,this)}createBackground(){const e=this.add.graphics();e.fillStyle(657935,1),e.fillRect(0,0,this.scale.width,this.scale.height);const t=8,i=this.add.graphics();i.lineStyle(1,65480,.15);for(let l=0;l<=this.scale.width;l+=t)i.moveTo(l,0),i.lineTo(l,this.scale.height);for(let l=0;l<=this.scale.height;l+=t)i.moveTo(0,l),i.lineTo(this.scale.width,l);i.strokePath();const s=this.add.graphics();for(let l=0;l<30;l++){const r=Math.floor(Math.random()*(this.scale.width/t))*t,o=Math.floor(Math.random()*(this.scale.height/t))*t,d=t*(1+Math.floor(Math.random()*2)),c=.1+Math.random()*.2,p=[65480,16711935,16711782],f=p[Math.floor(Math.random()*p.length)];s.fillStyle(f,c),s.fillRect(r,o,d,d)}const a=this.add.graphics();a.fillStyle(657935,.7),a.fillRect(0,0,this.scale.width,this.scale.height);const h=this.add.graphics();h.fillStyle(65480,.05),h.fillRect(0,0,100,100),h.fillStyle(16711782,.05),h.fillRect(this.scale.width-100,this.scale.height-100,100,100)}resetGame(){this.isGameOver=!1,this.isPaused=!1,this.gameTime=0,this.score=0,this.grazeCount=0,this.slowMotionActive=!1,this.slowMotionTimer=0}update(e,t){if(this.isGameOver||this.isPaused)return;let i=this.slowMotionActive?.3:1,s=t*i;this.slowMotionActive&&(this.slowMotionTimer-=t,this.slowMotionTimer<=0&&this.deactivateSlowMotion()),this.gameTime+=s,this.player.update(s,this.cursors,this.spaceKey,this.mousePointer),this.boss.update(s,this.player.getPosition()),this.bulletPool.getPool().children.entries.forEach(a=>{a.active&&a.update(e,s,this.player.getPosition())}),this.checkGraze(),this.boss.isDead()&&this.onBossDefeated?.(),this.updateStats()}handlePlayerBulletCollision(e,t){const i=t;if(!i.active||i.isFake)return;if(this.player.isDashing){i.destroy();return}window.Phaser.Math.Distance.Between(this.player.sprite.x,this.player.sprite.y,i.x,i.y)<20&&!this.slowMotionActive&&this.activateSlowMotion(),this.player.takeDamage()&&(i.destroy(),this.player.health<=0&&this.gameOver())}handlePlayerBossCollision(){if(this.player.isDashing&&this.player.isInvincible){const e=this.boss.takeDamage(5);this.upgrades.lifeSteal&&this.player.heal(),this.score+=100,this.createHitEffect(this.boss.getPosition().x,this.boss.getPosition().y),e&&this.bossDefeated()}}checkGraze(){if(!this.player.canGraze())return;const e=this.player.getPosition();let t=!1;this.bulletPool.getPool().children.entries.forEach(i=>{if(!i.active||i.isFake)return;const s=window.Phaser.Math.Distance.Between(e.x,e.y,i.x,i.y);s<this.player.grazeRadius&&s>12&&(t=!0,this.grazeCount++,this.score+=10*this.upgrades.grazeScoreMultiplier,this.createGrazeEffect(i.x,i.y))}),t&&(this.player.doGraze(),this.sound.play("graze",{volume:.2}))}createGrazeEffect(e,t){const s=this.add.graphics();s.fillStyle(65480,.8),s.fillRect(e-4,t-8,8,4),s.fillRect(e-4,t+4,8,4),s.fillRect(e-8,t-4,4,8),s.fillRect(e+4,t-4,4,8),s.setBlendMode(window.Phaser.BlendModes.ADD),this.tweens.add({targets:s,alpha:0,scale:1.5,duration:200,onComplete:()=>{s.destroy()}})}createHitEffect(e,t){const i=this.add.graphics(),s=6;i.fillStyle(16711782,1),i.fillRect(e-s,t-s,s*2,s*2),i.fillStyle(16711935,.7),i.fillRect(e-s*2,t-s*2,s,s),i.fillRect(e+s,t-s*2,s,s),i.fillRect(e-s*2,t+s,s,s),i.fillRect(e+s,t+s,s,s),i.setBlendMode(window.Phaser.BlendModes.ADD),this.tweens.add({targets:i,alpha:0,scale:1.8,duration:300,onComplete:()=>{i.destroy()}})}activateSlowMotion(){this.slowMotionActive=!0,this.slowMotionTimer=300,this.cameras.main.shake(100,.01),this.sound.play("slow-motion",{volume:.3}),this.cameras.main.setZoom(1.05),this.cameras.main.setAlpha(.9)}deactivateSlowMotion(){this.slowMotionActive=!1,this.cameras.main.setZoom(1),this.cameras.main.setAlpha(1)}spawnBullets(e,t,i,s,a){return this.bulletPool.spawnCircle(e,t,i,a,s)}bossDefeated(){const e=this.boss.getPosition(),t=this.add.graphics(),i=8;for(let s=0;s<4;s++){const a=6+s*2,h=20+s*15;for(let l=0;l<a;l++){const r=l/a*Math.PI*2+s*.5,o=e.x+Math.cos(r)*h,d=e.y+Math.sin(r)*h,c=[16711782,16711935,16776960,65480],p=c[Math.floor(Math.random()*c.length)];t.fillStyle(p,1-s*.2),t.fillRect(o-i/2,d-i/2,i,i)}}t.fillStyle(16777215,1),t.fillRect(e.x-i*2,e.y-i*2,i*4,i*4),t.setBlendMode(window.Phaser.BlendModes.ADD),this.tweens.add({targets:t,alpha:0,scale:2,duration:800,onComplete:()=>{t.destroy()}}),this.sound.play("explosion",{volume:.8}),this.score+=5e3,this.onBossDefeated?.()}gameOver(){this.isGameOver=!0,this.onGameOver?.(this.score,this.gameTime)}updateStats(){this.onStatsUpdate&&this.onStatsUpdate({score:this.score,grazeCount:this.grazeCount,time:this.gameTime,health:this.player.health,bossHealth:this.boss.health,bossPhase:this.boss.getPhase()})}applyUpgrade(e){switch(e){case"dash-cooldown":this.upgrades.dashCooldownReduction+=.2,this.player.dashCooldown*=1-this.upgrades.dashCooldownReduction;break;case"dash-distance":this.upgrades.dashDistanceIncrease+=.3,this.player.dashSpeed*=1+this.upgrades.dashDistanceIncrease;break;case"graze-score":this.upgrades.grazeScoreMultiplier*=2;break;case"life-steal":this.upgrades.lifeSteal=!0;break}}enhanceForEndless(e){this.boss.maxHealth=100+e*50,this.boss.health=this.boss.maxHealth,this.boss.attackInterval=Math.max(500,2e3-e*100),this.boss.moveSpeed=Math.min(100,30+e*5)}pause(){this.isPaused=!0,this.physics.pause()}resume(){this.isPaused=!1,this.physics.resume()}restart(){this.bulletPool.clear(),this.boss.destroy(),this.player.destroy(),this.scene.restart()}}export{S as GameScene};
